Description: Variable Load Limit
Category: DER
Classes:
  - DER-L

TargetVersions:
  - v1.2
  - v1.3-beta/storage

Criteria:
  checks:
    - type: all-steps-complete
      parameters: {}
    - type: response-contents # DERC 1
      parameters: 
        status: 1 # Received
        subject_tag: DERC1
    - type: response-contents
      parameters: 
        status: 2 # Started
        subject_tag: DERC1
    - type: response-contents
      parameters: 
        status: 3 # Completed
        subject_tag: DERC1
    - type: response-contents # DERC 2
      parameters: 
        status: 1
        subject_tag: DERC2
    - type: response-contents
      parameters: 
        status: 2
        subject_tag: DERC2
    - type: response-contents
      parameters: 
        status: 3
        subject_tag: DERC2
    - type: response-contents # DERC 3
      parameters: 
        status: 1
        subject_tag: DERC3
    - type: response-contents
      parameters: 
        status: 2
        subject_tag: DERC3
    - type: response-contents
      parameters: 
        status: 3
        subject_tag: DERC3
    - type: response-contents # DERC 4
      parameters: 
        status: 1
        subject_tag: DERC4
    - type: response-contents
      parameters: 
        status: 2
        subject_tag: DERC4
    - type: response-contents
      parameters: 
        status: 3
        subject_tag: DERC4
    - type: response-contents # DERC 5
      parameters: 
        status: 1
        subject_tag: DERC5
    - type: response-contents
      parameters: 
        status: 2
        subject_tag: DERC5
    - type: response-contents
      parameters: 
        status: 3
        subject_tag: DERC5

Preconditions:
  init_actions:
    - type: set-comms-rate
      parameters:
        dcap_poll_seconds: 60
        edev_list_poll_seconds: 60
        fsa_list_poll_seconds: 60
        der_list_poll_seconds: 60 
        derp_list_poll_seconds: 60
        mup_post_seconds: 60
    - type: create-der-program
      parameters:
        primacy: 0

  checks:
    - type: end-device-contents
      parameters: {}
    - type: der-settings-contents
      parameters: {}

Steps:
  # CREATE DER CONTROLS (all at once to avoid gaps between controls)
  GET-DER-CONTROLS:
    event:
      type: GET-request-received
      parameters:
        endpoint: /edev/1/derp/1/derc
    actions:
      - type: create-der-control # Create DERControl 1 - set to 200% of max
        parameters:
          start: $(now)
          duration_seconds: 120
          opModLoadLimW: $(setMaxW * 2)
          tag: DERC1
      - type: create-der-control # Create DERControl 2 - set to 100% of max
        parameters:
          start: $(now + '2 minutes')
          duration_seconds: 120
          opModLoadLimW: $(setMaxW)
          tag: DERC2
      - type: create-der-control # Create DERControl 3 - set to 40% of max
        parameters:
          start: $(now + '4 minutes')
          duration_seconds: 120
          opModLoadLimW: $(setMaxW * 0.4)
          tag: DERC3
      - type: create-der-control  # Create DERControl 4 - set to 25% of max
        parameters:
          start: $(now + '6 minutes')
          duration_seconds: 120
          opModLoadLimW: $(setMaxW * 0.25)
          tag: DERC4
      - type: create-der-control # Create DERControl 5 - set to 0
        parameters:
          start: $(now + '8 minutes')
          duration_seconds: 120
          opModLoadLimW: 0
          tag: DERC5
      - type: remove-steps
        parameters:
          steps:
            - GET-DER-CONTROLS