Description: Active Control - Energise / De-energise 
Category: Control
Classes:
 - A

TargetVersions:
 - v1.2

Preconditions:
  required_clients:
    - id: client
  
Steps:
  - id: (A) PRECONDITION
    repeat_until_pass: true
    client: client
    instructions:
      - Create an EndDevice registration.
      - Configure an active control with opModEnergize = true and without including the rampTms attribute.
    action: 
      type: discovery
      parameters:
        resources:
          - EndDevice
          - DERControl
    checks:
      - type: end-device 
        parameters:
          matches_client: true
      - type: der-control
        parameters:
          minimum_count: 1
          opModEnergize: true
          rampTms: null
          event_status: 1 # Active
    
  - id: (1) De-energize
    repeat_until_pass: true
    client: client
    instructions:
      - Configure an active control with opModEnergize = false and without including the rampTms attribute.
    action: 
      type: discovery
      parameters:
        resources:
          - DERControlList
          - DER
          - DERControl
    checks:
      - type: der-control
        parameters:
          minimum_count: 1
          opModEnergize: false
          rampTms: null
          event_status: 1 # Active
      
  - id: (2) Energize
    repeat_until_pass: true
    client: client
    instructions:
      - Configure an active control with opModEnergize = true and without including the rampTms attribute.
    action: 
      type: discovery
      parameters:
        resources:
          - DERControlList
          - DER
          - DERControl
    checks:
      - type: der-control
        parameters:
          minimum_count: 1
          opModEnergize: true
          rampTms: null
          event_status: 1 # Active
