Description: Reject Incomplete DER Settings
Category: Edge Cases
Classes:
 - A

TargetVersions:
 - v1.2

Preconditions:
  required_clients:
    - id: client
  
Steps:
  - id: PRECONDITION
    repeat_until_pass: true
    instructions:
      - Create an EndDevice registration.
    action:
      type: discovery
      parameters:
        resources:
          - EndDevice
          - DeviceCapability
          - DER
    checks:
      - type: end-device # This will be the check that will block UNTIL there is an existing EndDevice registration
        parameters:
          matches_client: true

  - id: 1 - SEND MALFORMED DERSettings
    action:
      type: send-malformed-der-settings
      parameters:
        updatedTime_missing: true

  - id: 2 - Upsert modes enabled
  # NOTE: Cannot test for 400 error when sending int vs hexBinary - the server cannot distinguish them.
  # Instead, this test verifies the server correctly handles valid hexBinary values.
    action:
      type: upsert-der-settings
      parameters:
        setMaxW: 10000
        setGradW: 1000
        modesEnabled: 12 # Double digit, will be checked by the upsert and refetch
        doeModesEnabled: 3
