Description: Active Controls - Control Combinations
Category: Subscription / Notification
Classes:
 - A

TargetVersions:
 - v1.2

Preconditions:
  required_clients:
    - id: client
  
Steps:
  - id: PRECONDITION 1 - CREATE END DEVICE
    repeat_until_pass: true
    instructions:
      - Create an EndDevice registration for client and the subscription process as defined in test S-ALL-25. 
    action: 
      type: discovery
      parameters:
        resources:
          - EndDevice
          - FunctionSetAssignments
          - DERProgram
          - SubscriptionList
          - DERControl
          - DERControlList
    checks:
      - type: end-device 
        parameters:
          matches_client: true
    
  - id: PRECONDITION2 - DERC LIST SUBSCRIBE
    action: 
      type: create-subscription
      parameters:
        sub_id: derc_list_sub
        resource: DERControlList

  - id: PRECONDITION 3 - CREATE DERC
    repeat_until_pass: true
    instructions:
      - Create an active DERControl with opModConnect=true.
    action: 
      type: discovery
      parameters:
        resources: 
          - DERControl
    checks:
      - type: der-control
        parameters:
          minimum_count: 1
          maximum_count: 1
          opModConnect: true
          event_status: 1 # Active
          sub_id: derc_list_sub

  - id: STEP 1 - CREATE DERC
    repeat_until_pass: true
    instructions: 
      - The server is configured with an active control.
      - opModExpLimW = 50% of the DER active power rating
      - opModGenLimW = 0W
      - opModImpLimW = 50% of the DER active power rating
      - opModLoadLimW = 0W
      - opModEnergize = false
      - opModConnect = false
      - rampTms not included
    action: 
      type: notifications
      parameters:
        sub_id: derc_list_sub
        collect: true
    checks:
      - type: der-control
        parameters:
          minimum_count: 1
          maximum_count: 1
          opModExpLimW: $(setMaxW * 0.5)
          opModGenLimW: 0
          opModImpLimW: $(setMaxW * 0.5)
          opModLoadLimW: 0
          opModEnergize: false
          opModConnect: false
          event_status: 1 # Active
          sub_id: derc_list_sub